// ===========================
// DONNÃ‰ES - Banques de prÃ©dictions
// ===========================

const predictions = {
    tech: {
        wishes: [
            "Que ton annÃ©e soit parsemÃ©e de bugs rÃ©solus avant mÃªme d'apparaÃ®tre, et que tes algorithmes dansent comme des lucioles sur l'Ã©cran de minuit.",
            "Les serveurs t'ouvrent leurs bras d'acier bienveillant, et la fibre optique te chante des berceuses en binaire. Que 2026 soit ton royaume de silicium.",
            "Puissent tes lignes de code fleurir comme des roses numÃ©riques, et que chaque commit soit un poÃ¨me Ã©crit en Python cÃ©leste.",
            "Que les octets tombent sur toi comme une pluie tiÃ¨de de mars, et que ton terminal soit un jardin oÃ¹ germent les solutions.",
            "Les nuages informatiques t'apportent leur ombre douce, et ton clavier devient un piano qui compose des symphonies infinies.",
            "Que tes projets grandissent tel un baobab connectÃ©, et que ton Wi-Fi soit Ã©ternel comme l'amour d'un serveur dÃ©diÃ©.",
            "Les pixels te sourient depuis l'Ã©cran, et chaque API devient un pont d'or vers des contrÃ©es inexplorÃ©es.",
            "Que ton intelligence artificielle soit aussi bienveillante qu'un chaton, et tes bases de donnÃ©es aussi ordonnÃ©es qu'un ballet cosmique.",
            "Les transistors murmurent ton nom dans leurs rÃªves Ã©lectriques, et 2026 deviendra l'annÃ©e oÃ¹ tu hackeras le bonheur.",
            "Puisse ton cerveau fusionner harmonieusement avec le machine learning, et que chaque itÃ©ration te rapproche de la sÃ©rÃ©nitÃ© numÃ©rique."
        ],
        predictions: [
            "Tu inventeras un algorithme qui prÃ©dira les cÃ¢lins, et les robots pleureront de joie.",
            "Une IA tombera amoureuse de ton cafÃ© du matin et t'offrira un chatbot poÃ©tique en guise de dÃ©claration.",
            "Ton code source sera exposÃ© au MoMA, entre un Picasso et une sculpture de lumiÃ¨re quantique.",
            "Tu dÃ©couvriras que Ctrl+Z fonctionne aussi dans la vraie vie, et tu effaceras toutes tes gaffes de 2025.",
            "Un neurone artificiel portera ton prÃ©nom et rÃ©soudra l'Ã©quation du bonheur universel.",
            "Tu seras invitÃ©(e) Ã  dÃ®ner par un hologramme qui connaÃ®t toutes tes blagues prÃ©fÃ©rÃ©es.",
            "Tes bugs deviendront des features, et Silicon Valley te nommera Â« PoÃ¨te du Code Â».",
            "Une blockchain t'apportera un message d'amour cryptÃ© venu de l'an 3000.",
            "Tu parleras couramment le langage des machines Ã  cafÃ© connectÃ©es, et elles te prÃ©pareront des expressos parfaits.",
            "Ton pull gÃ©ek sera dÃ©clarÃ© patrimoine de l'humanitÃ© par l'UNESCO numÃ©rique.",
            "Tu coderas en dormant et crÃ©eras une app qui traduit les ronflements en musique ambient.",
            "Les GPUs du monde entier se lÃ¨veront pour t'applaudir lors d'une keynote improvisÃ©e."
        ]
    },
    business: {
        wishes: [
            "Que tes rÃ©unions soient des jardins de conversations fertiles, oÃ¹ chaque idÃ©e pousse comme un tournesol gÃ©ant.",
            "Les tableurs t'offrent leur sagesse chiffrÃ©e, et ton agenda devient un tapis volant vers le succÃ¨s.",
            "Puisse ton leadership briller comme un phare dans la tempÃªte Excel, et que tes Ã©quipes naviguent vers des rivages heureux.",
            "Que chaque contrat signÃ© soit une poignÃ©e de main cosmique, et que ton rÃ©seau LinkedIn devienne une constellation.",
            "Les PowerPoints te sourient depuis leurs diapositives, et ton chiffre d'affaires danse le tango avec l'infini.",
            "Que ton elevator pitch soit aussi percutant qu'un haÃ¯ku prononcÃ© par un samouraÃ¯, et que les investisseurs pleuvent comme des Ã©toiles filantes.",
            "Les KPIs te chantent des mÃ©lodies optimistes, et chaque trimestre devient un chapitre de roman Ã  succÃ¨s.",
            "Puisse ton cafÃ© du matin contenir des secrets de stratÃ©gie, et que tes pauses dÃ©jeuner soient des brainstormings inspirÃ©s.",
            "Les graphiques ascendants te portent sur leurs Ã©paules, et ton bureau devient un temple de productivitÃ© bienveillante.",
            "Que 2026 transforme ta vision en rÃ©alitÃ© dorÃ©e, et que chaque obstacle se mue en tremplin couvert de velours."
        ],
        predictions: [
            "Tu nÃ©gocieras un deal avec une licorne (oui, la vraie) et deviendras conseiller(Ã¨re) en stratÃ©gie mythologique.",
            "Ton business plan sera si Ã©loquent que mÃªme les plantes vertes de ton bureau l'applaudiront.",
            "Un CEO milliardaire te demandera ton secret, et tu rÃ©pondras : Â« J'Ã©coute les oiseaux le matin. Â»",
            "Tu organiseras une rÃ©union Zoom oÃ¹ tout le monde sera Ã  l'heure, la lÃ©gende en parlera pendant des siÃ¨cles.",
            "Ton ROI atteindra des sommets si hauts que les comptables inventeront de nouveaux chiffres pour le mesurer.",
            "Warren Buffett te demandera conseil, et tu lui suggÃ©reras d'investir dans des cookies artisanaux.",
            "Tu deviendras viral sur LinkedIn pour avoir postÃ© une photo de ton chat avec un costume-cravate.",
            "Ta signature Ã©lectronique sera reconnue comme Å“uvre d'art calligraphique par Christie's.",
            "Un algorithme de recrutement t'identifiera comme Â« trop visionnaire Â» et proposera de crÃ©er un poste rien que pour toi.",
            "Tu dÃ©couvriras que la vraie rÃ©ussite, c'est d'arriver Ã  ouvrir le pot de cornichons du premier coup.",
            "Ton networking sera si puissant que mÃªme les inconnus dans la rue te proposeront des partenariats.",
            "Forbes te mettra en couverture avec ce titre : Â« La personne qui a rÃ©inventÃ© la pause-cafÃ© Â»."
        ]
    },
    creation: {
        wishes: [
            "Que tes pinceaux deviennent des baguettes magiques, et que chaque couleur raconte une histoire d'amour avec la toile.",
            "Les muses descendent de l'Olympe pour applaudir tes crÃ©ations, et ton imagination devient un ocÃ©an de possibles.",
            "Puisse ton inspiration jaillir comme une fontaine de chocolat chaud, et que tes idÃ©es brillent telles des lucioles Ã©garÃ©es.",
            "Que chaque projet soit un voyage vers une planÃ¨te inconnue, et que ton crayon soit un astronef poÃ©tique.",
            "Les formes et les lignes dansent autour de toi comme des papillons ivres de beautÃ©, et ton art devient un hymne Ã  la vie.",
            "Puisse ta crÃ©ativitÃ© Ã©clore comme un lotus gÃ©ant au milieu d'un lac de cafÃ© corsÃ©.",
            "Que tes erreurs se transforment en coups de gÃ©nie, et que chaque brouillon soit une esquisse du sublime.",
            "Les galeries d'art te supplient d'exposer, et les critiques perdent leurs mots devant tant de splendeur.",
            "Puisse ton studio devenir un sanctuaire oÃ¹ la beautÃ© prend racine, et oÃ¹ chaque outil murmure des secrets anciens.",
            "Que 2026 soit l'annÃ©e oÃ¹ ton Ã¢me d'artiste embrasse l'univers et lui offre un bouquet d'Ã©toiles."
        ],
        predictions: [
            "Tu crÃ©eras une Å“uvre si puissante qu'elle fera pleurer un cactus de joie.",
            "Une mouette volera ton croquis et le dÃ©posera devant le MET, qui l'exposera immÃ©diatement.",
            "Tu inventeras une nouvelle couleur que Pantone nommera Â« L'Espoir DorÃ© Â».",
            "Ton Å“uvre sera achetÃ©e par un collectionneur extraterrestre qui paiera en poussiÃ¨re d'Ã©toiles.",
            "Un musÃ©e ouvrira une aile entiÃ¨re dÃ©diÃ©e Ã  ton doodle du jeudi aprÃ¨s-midi.",
            "Tu dÃ©couvriras que ta gomme contient un portail vers une dimension crÃ©ative infinie.",
            "Les oiseaux composeront une chanson inspirÃ©e par ta palette de couleurs.",
            "Tu seras invitÃ©(e) Ã  peindre la fresque officielle de la paix mondiale (sur un croissant gÃ©ant).",
            "Ton Å“uvre sera tellement touchante que mÃªme les statues te feront un cÃ¢lin.",
            "Une galerie parisienne baptisera son vernissage Â« L'Ã‰veil de l'Imaginaire Â», en ton honneur.",
            "Tu recevras une lettre de fÃ©licitations signÃ©e par LÃ©onard de Vinci (oui, via pigeon voyageur temporel).",
            "Ton carnet de croquis deviendra un best-seller et inspirera une gÃ©nÃ©ration de rÃªveurs."
        ]
    },
    event: {
        wishes: [
            "Que tes Ã©vÃ©nements soient des feux d'artifice d'Ã©motions, et que chaque invitÃ© reparte avec des Ã©toiles plein les yeux.",
            "Les confettis tombent en ton honneur comme une pluie de bonheur multicolore, et la musique devient ton alliÃ©e indÃ©fectible.",
            "Puisse chaque soirÃ©e que tu organises Ãªtre une lÃ©gende racontÃ©e autour des feux de camp du futur.",
            "Que tes playlists soient des sortilÃ¨ges qui font danser mÃªme les plus timides, et que l'ambiance soit toujours Ã©lectrique.",
            "Les lieux s'illuminent Ã  ton passage, et tes dÃ©corations transforment le banal en fÃ©erie absolue.",
            "Puisse ton agenda Ãªtre rempli de moments magiques, et que chaque Ã©vÃ©nement soit une page de conte merveilleux.",
            "Que les DJ te vÃ©nÃ¨rent, les traiteurs t'adorent, et que les photographes capturent ton gÃ©nie organisationnel.",
            "Puissent tes invitations devenir des reliques prÃ©cieuses que l'on conserve jalousement.",
            "Que ton sourire soit la clÃ© qui ouvre toutes les portes des salles les plus prestigieuses.",
            "Puisse 2026 t'offrir des moments de cÃ©lÃ©bration si intenses qu'ils rÃ©Ã©criront la dÃ©finition du bonheur."
        ],
        predictions: [
            "Tu organiseras un Ã©vÃ©nement tellement rÃ©ussi que mÃªme les licornes voudront une invitation.",
            "Ta soirÃ©e sera si lÃ©gendaire qu'on en parlera encore dans 200 ans, avec des reconstitutions historiques.",
            "Un DJ mondialement connu te demandera de mixer sa playlist, et tu accepteras avec grÃ¢ce.",
            "Tu crÃ©eras un concept d'Ã©vÃ©nement si innovant que TED te demandera de faire une confÃ©rence.",
            "Les confettis t'obÃ©iront au doigt et Ã  l'Å“il, et formeront ton prÃ©nom dans le ciel.",
            "Tu seras nommÃ©(e) Â« Architecte du Bonheur Collectif Â» par l'AcadÃ©mie Internationale de la FÃªte.",
            "Ton cocktail signature deviendra viral et sera servi dans tous les bars branchÃ©s de la planÃ¨te.",
            "Un flashmob spontanÃ© Ã©clatera en ton honneur lors de ton prochain Ã©vÃ©nement.",
            "Tu recevras une invitation Ã  organiser le gala d'anniversaire d'une star hollywoodienne.",
            "Ton talent d'organisateur(trice) sera reconnu par un prix intitulÃ© Â« Le CÃ©sar de la ConvivialitÃ© Â».",
            "Les ballons hÃ©lium formeront un arc-en-ciel gÃ©ant au-dessus de ta prochaine soirÃ©e.",
            "Tu dÃ©couvriras que ta vraie superpower, c'est de faire sourire 500 personnes en mÃªme temps."
        ]
    }
};

// ===========================
// VARIABLES GLOBALES
// ===========================
let selectedUniverse = null;
let currentPrediction = null;

// ===========================
// GESTION DU FORMULAIRE
// ===========================

// SÃ©lection des Ã©lÃ©ments
const formScreen = document.getElementById('formScreen');
const resultScreen = document.getElementById('resultScreen');
const form = document.getElementById('predictionForm');
const prenomInput = document.getElementById('prenom');
const universeInput = document.getElementById('universe');
const prenomError = document.getElementById('prenomError');
const universeError = document.getElementById('universeError');
const universeCards = document.querySelectorAll('.universe-card');

// Gestion de la sÃ©lection d'univers
universeCards.forEach(card => {
    card.addEventListener('click', () => {
        // Retirer la sÃ©lection prÃ©cÃ©dente
        universeCards.forEach(c => c.classList.remove('selected'));

        // Ajouter la sÃ©lection actuelle
        card.classList.add('selected');
        selectedUniverse = card.dataset.universe;
        universeInput.value = selectedUniverse;

        // Effacer le message d'erreur
        universeError.textContent = '';
    });
});

// Validation du formulaire
form.addEventListener('submit', (e) => {
    e.preventDefault();

    let isValid = true;

    // Valider le prÃ©nom
    const prenom = prenomInput.value.trim();
    if (!prenom) {
        prenomError.textContent = 'Entre ton prÃ©nom pour continuer';
        isValid = false;
    } else {
        prenomError.textContent = '';
    }

    // Valider l'univers
    if (!selectedUniverse) {
        universeError.textContent = 'Choisis un univers qui te correspond';
        isValid = false;
    } else {
        universeError.textContent = '';
    }

    if (isValid) {
        generatePrediction(prenom, selectedUniverse);
        showResultScreen();
    }
});

// ===========================
// GÃ‰NÃ‰RATION DE LA CARTE
// ===========================

function generatePrediction(prenom, universe) {
    const data = predictions[universe];

    // SÃ©lection alÃ©atoire
    const randomWish = data.wishes[Math.floor(Math.random() * data.wishes.length)];
    const randomPrediction = data.predictions[Math.floor(Math.random() * data.predictions.length)];

    // Mapper les noms d'univers pour l'affichage
    const universeNames = {
        tech: 'Tech & IA',
        business: 'Business',
        creation: 'CrÃ©ation',
        event: 'Event'
    };

    // Mettre Ã  jour la carte
    document.getElementById('cardBadge').textContent = `â˜… ${universeNames[universe]}`;
    document.getElementById('cardGreeting').textContent = `Cher ${prenom},`;
    document.getElementById('cardWishes').textContent = randomWish;
    document.getElementById('cardPrediction').textContent = randomPrediction;

    // Stocker pour usage ultÃ©rieur (partage, copie)
    currentPrediction = {
        prenom,
        universe,
        universeName: universeNames[universe],
        wish: randomWish,
        prediction: randomPrediction
    };
}

function showResultScreen() {
    formScreen.classList.remove('active');
    resultScreen.classList.add('active');
}

function showFormScreen() {
    resultScreen.classList.remove('active');
    formScreen.classList.add('active');

    // Reset du formulaire
    form.reset();
    universeCards.forEach(c => c.classList.remove('selected'));
    selectedUniverse = null;
    prenomError.textContent = '';
    universeError.textContent = '';
}

// ===========================
// TÃ‰LÃ‰CHARGEMENT PNG
// ===========================

document.getElementById('downloadBtn').addEventListener('click', async () => {
    const cardElement = document.querySelector('.prediction-card');
    const btn = document.getElementById('downloadBtn');

    // DÃ©sactiver le bouton pendant le traitement
    btn.disabled = true;
    btn.textContent = 'â³ GÃ©nÃ©ration en cours...';

    try {
        // Utiliser html2canvas pour capturer la carte
        const canvas = await html2canvas(cardElement, {
            scale: 2, // Haute rÃ©solution
            backgroundColor: null,
            logging: false,
            useCORS: true
        });

        // Convertir en blob et tÃ©lÃ©charger
        canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');

            // CrÃ©er un nom de fichier propre
            const cleanPrenom = currentPrediction.prenom.toLowerCase().replace(/[^a-z0-9]/g, '');
            const cleanUniverse = currentPrediction.universe;
            link.download = `prediction-madame-iarma-2026-${cleanPrenom}-${cleanUniverse}.png`;

            link.href = url;
            link.click();

            // Nettoyer
            URL.revokeObjectURL(url);

            // Restaurer le bouton
            btn.disabled = false;
            btn.textContent = 'ðŸ“¥ TÃ©lÃ©charger la prÃ©diction';
        });
    } catch (error) {
        console.error('Erreur lors de la gÃ©nÃ©ration du PNG:', error);
        alert('DÃ©solÃ©, une erreur est survenue lors de la gÃ©nÃ©ration de l\'image. Essaie de faire une capture d\'Ã©cran Ã  la place !');

        // Restaurer le bouton
        btn.disabled = false;
        btn.textContent = 'ðŸ“¥ TÃ©lÃ©charger la prÃ©diction';
    }
});



// ===========================
// NOUVELLE CARTE
// ===========================

document.getElementById('newCardLink').addEventListener('click', (e) => {
    e.preventDefault();
    showFormScreen();
});
