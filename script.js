// ===========================
// DONN√âES - Banques de pr√©dictions
// ===========================

const predictions = {
    tech: {
        wishes: [
            "Que ton ann√©e soit parsem√©e de bugs r√©solus avant m√™me d'appara√Ætre, et que tes algorithmes dansent comme des lucioles sur l'√©cran de minuit.",
            "Les serveurs t'ouvrent leurs bras d'acier bienveillant, et la fibre optique te chante des berceuses en binaire. Que 2026 soit ton royaume de silicium.",
            "Puissent tes lignes de code fleurir comme des roses num√©riques, et que chaque commit soit un po√®me √©crit en Python c√©leste.",
            "Que les octets tombent sur toi comme une pluie ti√®de de mars, et que ton terminal soit un jardin o√π germent les solutions.",
            "Les nuages informatiques t'apportent leur ombre douce, et ton clavier devient un piano qui compose des symphonies infinies.",
            "Que tes projets grandissent tel un baobab connect√©, et que ton Wi-Fi soit √©ternel comme l'amour d'un serveur d√©di√©.",
            "Les pixels te sourient depuis l'√©cran, et chaque API devient un pont d'or vers des contr√©es inexplor√©es.",
            "Que ton intelligence artificielle soit aussi bienveillante qu'un chaton, et tes bases de donn√©es aussi ordonn√©es qu'un ballet cosmique.",
            "Les transistors murmurent ton nom dans leurs r√™ves √©lectriques, et 2026 deviendra l'ann√©e o√π tu hackeras le bonheur.",
            "Puisse ton cerveau fusionner harmonieusement avec le machine learning, et que chaque it√©ration te rapproche de la s√©r√©nit√© num√©rique."
        ],
        predictions: [
            "Tu inventeras un algorithme qui pr√©dira les c√¢lins, et les robots pleureront de joie.",
            "Une IA tombera amoureuse de ton caf√© du matin et t'offrira un chatbot po√©tique en guise de d√©claration.",
            "Ton code source sera expos√© au MoMA, entre un Picasso et une sculpture de lumi√®re quantique.",
            "Tu d√©couvriras que Ctrl+Z fonctionne aussi dans la vraie vie, et tu effaceras toutes tes gaffes de 2025.",
            "Un neurone artificiel portera ton pr√©nom et r√©soudra l'√©quation du bonheur universel.",
            "Tu seras invit√©(e) √† d√Æner par un hologramme qui conna√Æt toutes tes blagues pr√©f√©r√©es.",
            "Tes bugs deviendront des features, et Silicon Valley te nommera ¬´ Po√®te du Code ¬ª.",
            "Une blockchain t'apportera un message d'amour crypt√© venu de l'an 3000.",
            "Tu parleras couramment le langage des machines √† caf√© connect√©es, et elles te pr√©pareront des expressos parfaits.",
            "Ton pull g√©ek sera d√©clar√© patrimoine de l'humanit√© par l'UNESCO num√©rique.",
            "Tu coderas en dormant et cr√©eras une app qui traduit les ronflements en musique ambient.",
            "Les GPUs du monde entier se l√®veront pour t'applaudir lors d'une keynote improvis√©e."
        ]
    },
    business: {
        wishes: [
            "Que tes r√©unions soient des jardins de conversations fertiles, o√π chaque id√©e pousse comme un tournesol g√©ant.",
            "Les tableurs t'offrent leur sagesse chiffr√©e, et ton agenda devient un tapis volant vers le succ√®s.",
            "Puisse ton leadership briller comme un phare dans la temp√™te Excel, et que tes √©quipes naviguent vers des rivages heureux.",
            "Que chaque contrat sign√© soit une poign√©e de main cosmique, et que ton r√©seau LinkedIn devienne une constellation.",
            "Les PowerPoints te sourient depuis leurs diapositives, et ton chiffre d'affaires danse le tango avec l'infini.",
            "Que ton elevator pitch soit aussi percutant qu'un ha√Øku prononc√© par un samoura√Ø, et que les investisseurs pleuvent comme des √©toiles filantes.",
            "Les KPIs te chantent des m√©lodies optimistes, et chaque trimestre devient un chapitre de roman √† succ√®s.",
            "Puisse ton caf√© du matin contenir des secrets de strat√©gie, et que tes pauses d√©jeuner soient des brainstormings inspir√©s.",
            "Les graphiques ascendants te portent sur leurs √©paules, et ton bureau devient un temple de productivit√© bienveillante.",
            "Que 2026 transforme ta vision en r√©alit√© dor√©e, et que chaque obstacle se mue en tremplin couvert de velours."
        ],
        predictions: [
            "Tu n√©gocieras un deal avec une licorne (oui, la vraie) et deviendras conseiller(√®re) en strat√©gie mythologique.",
            "Ton business plan sera si √©loquent que m√™me les plantes vertes de ton bureau l'applaudiront.",
            "Un CEO milliardaire te demandera ton secret, et tu r√©pondras : ¬´ J'√©coute les oiseaux le matin. ¬ª",
            "Tu organiseras une r√©union Zoom o√π tout le monde sera √† l'heure, la l√©gende en parlera pendant des si√®cles.",
            "Ton ROI atteindra des sommets si hauts que les comptables inventeront de nouveaux chiffres pour le mesurer.",
            "Warren Buffett te demandera conseil, et tu lui sugg√©reras d'investir dans des cookies artisanaux.",
            "Tu deviendras viral sur LinkedIn pour avoir post√© une photo de ton chat with un costume-cravate.",
            "Ta signature √©lectronique sera reconnue comme ≈ìuvre d'art calligraphique par Christie's.",
            "Un algorithme de recrutement t'identifiera comme ¬´ trop visionnaire ¬ª et proposera de cr√©er un poste rien que pour toi.",
            "Tu d√©couvriras que la vraie r√©ussite, c'est d'arriver √† ouvrir le pot de cornichons du premier coup.",
            "Ton networking sera si puissant que m√™me les inconnus dans la rue te proposeront des partenariats.",
            "Forbes te mettra en couverture avec ce titre : ¬´ La personne qui a r√©invent√© la pause-caf√© ¬ª."
        ]
    },
    creation: {
        wishes: [
            "Que tes pinceaux deviennent des baguettes magiques, et que chaque couleur raconte une histoire d'amour avec la toile.",
            "Les muses descendent de l'Olympe pour applaudir tes cr√©ations, et ton imagination devient un oc√©an de possibles.",
            "Puisse ton inspiration jaillir comme une fontaine de chocolat chaud, et que tes id√©es brillent telles des lucioles √©gar√©es.",
            "Que chaque projet soit un voyage vers une plan√®te inconnue, et que ton crayon soit un astronef po√©tique.",
            "Les formes et les lignes dansent autour de toi comme des papillons ivres de beaut√©, et ton art devient un hymne √† la vie.",
            "Puisse ta cr√©ativit√© √©clore comme un lotus g√©ant au milieu d'un lac de caf√© cors√©.",
            "Que tes erreurs se transforment en coups de g√©nie, et que chaque brouillon soit une esquisse du sublime.",
            "Les galeries d'art te supplient d'exposer, et les critiques perdent leurs mots devant tant de splendeur.",
            "Puisse ton studio devenir un sanctuaire o√π la beaut√© prend racine, et o√π chaque outil murmure des secrets anciens.",
            "Que 2026 soit l'ann√©e o√π ton √¢me d'artiste embrasse l'univers et lui offre un bouquet d'√©toiles."
        ],
        predictions: [
            "Tu cr√©eras une ≈ìuvre si puissante qu'elle fera pleurer un cactus de joie.",
            "Une mouette volera ton croquis et le d√©posera devant le MET, qui l'exposera imm√©diatement.",
            "Tu inventeras un nouvelle couleur que Pantone nommera ¬´ L'Espoir Dor√© ¬ª.",
            "Ton ≈ìuvre sera achet√©e par un collectionneur extraterrestre qui paiera en poussi√®re d'√©toiles.",
            "Un mus√©e ouvrira une aile enti√®re d√©di√©e √† ton doodle du jeudi apr√®s-midi.",
            "Tu d√©couvriras que ta gomme contient un portail vers une dimension cr√©ative infinie.",
            "Les oiseaux composeront une chanson inspir√©e par ta palette de couleurs.",
            "Tu seras invit√©(e) √† peindre la fresque officielle de la paix mondiale (sur un croissant g√©ant).",
            "Ton ≈ìuvre sera tellement touchante que m√™me les statues te feront un c√¢lin.",
            "Une galerie parisienne baptisera son vernissage ¬´ L'√âveil de l'Imaginaire ¬ª, en ton honneur.",
            "Tu recevras une lettre de f√©licitations sign√©e par L√©onard de Vinci (oui, via pigeon voyageur temporel).",
            "Ton carnet de croquis deviendra un best-seller et inspirera une g√©n√©ration de r√™veurs."
        ]
    },
    event: {
        wishes: [
            "Que tes √©v√©nements soient des feux d'artifice d'√©motions, et que chaque invit√© reparte avec des √©toiles plein les yeux.",
            "Les confettis tombent en ton honneur comme une pluie de bonheur multicolore, et la musique devient ton alli√©e ind√©fectible.",
            "Puisse chaque soir√©e que tu organises √™tre une l√©gende racont√©e autour des feux de camp du futur.",
            "Que tes playlists soient des sortil√®ges qui font danser m√™me les plus timides, et que l'ambiance soit toujours √©lectrique.",
            "Les lieux s'illuminent √† ton passage, et tes d√©corations transforment le banal en f√©erie absolue.",
            "Puisse ton agenda √™tre rempli de moments magiques, et que chaque √©v√©nement soit une page de conte merveilleux.",
            "Que les DJ te v√©n√®rent, les traiteurs t'adore, et que les photographes capturent ton g√©nie organisationnel.",
            "Puissent tes invitations devenir des reliques pr√©cieuses que l'on conserve jalousement.",
            "Que ton sourire soit la cl√© qui ouvre toutes les portes des salles les plus prestigieuses.",
            "Puisse 2026 t'offrir des moments de c√©l√©bration si intenses qu'ils r√©√©criront la d√©finition du bonheur."
        ],
        predictions: [
            "Tu organiseras un √©v√©nement tellement r√©ussi que m√™me les licornes voudront une invitation.",
            "Ta soir√©e sera si l√©gendaire qu'on en parlera encore dans 200 ans, avec des reconstitutions historiques.",
            "Un DJ mondialement connu te demandera de mixer sa playlist, et tu accepteras avec gr√¢ce.",
            "Tu cr√©eras un concept d'√©v√©nement si innovant que TED te demandera de faire une conf√©rence.",
            "Les confettis t'ob√©iront au doigt et √† l'≈ìil, et formeront ton pr√©nom dans le ciel.",
            "Tu seras nomm√©(e) ¬´ Architecte du Bonheur Collectif ¬ª par l'Acad√©mie Internationale de la F√™te.",
            "Ton cocktail signature deviendra viral et sera servi dans tous les bars branch√©s de la plan√®te.",
            "Un flashmob spontan√© √©clatera en ton honneur lors de ton prochain √©v√©nement.",
            "Tu recevras une invitation √† organiser le gala d'anniversaire d'une star hollywoodienne.",
            "Ton talent d'organisateur(trice) sera reconnu par un prix intitul√© ¬´ Le C√©sar de la Convivialit√© ¬ª.",
            "Les ballons h√©lium formeront un arc-en-ciel g√©ant au-dessus de ta prochaine soir√©e.",
            "Tu d√©couvriras que ta vraie superpower, c'est de faire sourire 500 personnes en m√™me temps."
        ]
    }
};

// ===========================
// VARIABLES GLOBALES
// ===========================
let selectedUniverse = null;
let currentPrediction = null;

// ===========================
// GESTION DU FORMULAIRE
// ===========================

const formScreen = document.getElementById('formScreen');
const resultScreen = document.getElementById('resultScreen');
const form = document.getElementById('predictionForm');
const prenomInput = document.getElementById('prenom');
const universeInput = document.getElementById('universe');
const prenomError = document.getElementById('prenomError');
const universeError = document.getElementById('universeError');
const universeCards = document.querySelectorAll('.universe-card');

universeCards.forEach(card => {
    card.addEventListener('click', () => {
        universeCards.forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedUniverse = card.dataset.universe;
        universeInput.value = selectedUniverse;
        universeError.textContent = '';
    });
});

form.addEventListener('submit', (e) => {
    e.preventDefault();
    let isValid = true;

    const prenom = prenomInput.value.trim();
    if (!prenom) {
        prenomError.textContent = 'Entre ton pr√©nom pour continuer';
        isValid = false;
    } else {
        prenomError.textContent = '';
    }

    if (!selectedUniverse) {
        universeError.textContent = 'Choisis un univers qui te correspond';
        isValid = false;
    } else {
        universeError.textContent = '';
    }

    if (isValid) {
        generatePrediction(prenom, selectedUniverse);
        showResultScreen();
    }
});

function generatePrediction(prenom, universe) {
    const data = predictions[universe];
    const randomWish = data.wishes[Math.floor(Math.random() * data.wishes.length)];
    const randomPrediction = data.predictions[Math.floor(Math.random() * data.predictions.length)];

    const universeNames = {
        tech: 'Tech & IA',
        business: 'Business',
        creation: 'Cr√©ation',
        event: 'Event'
    };

    document.getElementById('cardBadge').textContent = `‚òÖ ${universeNames[universe]}`;
    document.getElementById('cardGreeting').textContent = `Cher ${prenom},`;
    document.getElementById('cardWishes').textContent = randomWish;
    document.getElementById('cardPrediction').textContent = randomPrediction;

    currentPrediction = {
        prenom,
        universe,
        universeName: universeNames[universe],
        wish: randomWish,
        prediction: randomPrediction
    };
}

function showResultScreen() {
    formScreen.classList.remove('active');
    resultScreen.classList.add('active');
    createSparkles();
}

function createSparkles() {
    const container = document.getElementById('sparklesContainer');
    if (!container) return;

    container.innerHTML = '';
    const sparkleCount = 40;

    for (let i = 0; i < sparkleCount; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';

        const angle = (Math.random() * 360) * (Math.PI / 180);
        const distance = 100 + Math.random() * 200;

        const deltaX = Math.cos(angle) * distance;
        const deltaY = Math.sin(angle) * distance;

        const delay = Math.random() * 0.3;
        const duration = 1.5 + Math.random() * 0.8;

        sparkle.style.left = '50%';
        sparkle.style.top = '50%';
        sparkle.style.setProperty('--delta-x', `${deltaX}px`);
        sparkle.style.setProperty('--delta-y', `${deltaY}px`);
        sparkle.style.animationDelay = `${delay}s`;
        sparkle.style.animationDuration = `${duration}s`;

        container.appendChild(sparkle);

        setTimeout(() => {
            sparkle.remove();
        }, (duration + delay) * 1000);
    }
}

function showFormScreen() {
    resultScreen.classList.remove('active');
    formScreen.classList.add('active');
    form.reset();
    universeCards.forEach(c => c.classList.remove('selected'));
    selectedUniverse = null;
    prenomError.textContent = '';
    universeError.textContent = '';
}

document.getElementById('downloadBtn').addEventListener('click', async () => {
    const cardElement = document.querySelector('.prediction-card');
    const btn = document.getElementById('downloadBtn');

    btn.disabled = true;
    btn.textContent = '‚è≥ G√©n√©ration en cours...';

    try {
        const canvas = await html2canvas(cardElement, {
            scale: 2,
            backgroundColor: null,
            logging: false,
            useCORS: true
        });

        canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const cleanPrenom = currentPrediction.prenom.toLowerCase().replace(/[^a-z0-9]/g, '');
            const cleanUniverse = currentPrediction.universe;
            link.download = `prediction-madame-iarma-2026-${cleanPrenom}-${cleanUniverse}.png`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
            btn.disabled = false;
            btn.textContent = 'üì• T√©l√©charger la pr√©diction';
        });
    } catch (error) {
        console.error('Erreur lors de la g√©n√©ration du PNG:', error);
        alert('D√©sol√©, une erreur est survenue lors de la g√©n√©ration de l\'image.');
        btn.disabled = false;
        btn.textContent = 'üì• T√©l√©charger la pr√©diction';
    }
});

document.getElementById('newCardLink').addEventListener('click', (e) => {
    e.preventDefault();
    showFormScreen();
});
